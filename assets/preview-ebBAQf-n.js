import{r as I}from"./app-BY73wLkG.js";function V(){console.log("[Preview] Initialisation du mode Ã©diteur temps rÃ©el (FOCUS V2 - LIVE ARCHITECTURE)"),M();const w=new Map;function A(t,e){w.set(t,e),console.log(`[Preview] Update buffÃ©risÃ©e pour ${t} (Ã©lÃ©ment manquant)`)}function S(){if(w.size===0)return;console.log(`[Preview] Tentative de rejouer le buffer (${w.size} messages)...`);const t=Array.from(w.values());w.clear(),t.forEach(e=>{E({data:e})})}F(),H();const z={"palette.primary":"--primary-color","palette.secondary":"--secondary-color","palette.background":"--bg-color","palette.text":"--text-color","palette.accent":"--accent-color","palette.cardBackground":"--card-bg-color","palette.textMuted":"--text-muted-color","palette.cardBorder":"--card-border-color","palette.inputBackground":"--input-bg-color","palette.chatResponseBackground":"--chat-response-bg-color",primary:"--primary-color",secondary:"--secondary-color",background:"--bg-color",text:"--text-color",accent:"--accent-color",cardBackground:"--card-bg-color","primary-color":"--primary-color","bg-color":"--bg-color","card-bg-color":"--card-bg-color"};function b(t){if(!t)return null;if(typeof t=="string"&&t.startsWith("--"))return t;const e=String(t).trim(),o={"layout.borderRadius":"--border-radius","typography.headingFont":"--heading-font","typography.bodyFont":"--body-font"};if(o[e])return o[e];if(z[e])return z[e];if(e.startsWith("palette.")||e.startsWith("layout.")||e.startsWith("typography.")){const r=e.replace(/^(palette|layout|typography)[\._-]?/i,"").replace(/\./g,"").replace(/_/g,"").toLowerCase(),l={primary:"--primary-color",primary600:"--primary-600",primary700:"--primary-700",secondary:"--secondary-color",secondary600:"--secondary-600",background:"--bg-color",text:"--text-color",accent:"--accent-color",cardbackground:"--card-bg-color",textmuted:"--text-muted-color",cardborder:"--card-border-color",inputbackground:"--input-bg-color",chatresponsebackground:"--chat-response-bg-color",borderradius:"--border-radius",headingfont:"--heading-font",bodyfont:"--body-font"};return l[r]?l[r]:`--${e.replace(/^(palette|layout|typography)[\._-]?/i,"").replace(/\./g,"-").replace(/_([a-z0-9])/gi,(p,a)=>`-${a.toLowerCase()}`).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`}return null}function q(t={}){if(!t||typeof t!="object")return;const e=document.documentElement;Object.keys(t).forEach(o=>{const r=t[o];if(typeof r!="string"&&typeof r!="number")return;const l=o.startsWith("--")?o:b(o)||`--${o}`;e.style.setProperty(l,String(r))}),window.requestAnimationFrame(()=>{document.body.offsetHeight})}function L(t){const{sections:e}=t,o=document.querySelector('main[data-zflex-page-type="home"]');if(!o)return;console.log("[Preview] Syncing layout...",e);const r=Array.from(o.children).filter(p=>p.hasAttribute("data-zflex-section")),l=e.map(p=>p.type);let f=[];r.forEach(p=>{const a=p.getAttribute("data-zflex-section");a&&!l.includes(a)&&(console.log(`[Preview] Removing section ${a}`),p.remove())}),e.forEach(p=>{const a=p.type,s=a.replace(/[A-Z]/g,i=>`_${i.toLowerCase()}`),n=o.querySelector(`[data-zflex-section="${a}"]`)||o.querySelector(`[data-zflex-section="${s}"]`);n?(o.appendChild(n),n.getAttribute("data-zflex-section")!==a&&n.setAttribute("data-zflex-section",a)):(console.log(`[Preview] Missing section ${a} (checked ${s} too)`),f.push(a))}),f.length>0&&(console.warn(`[Preview] ${f.length} sections manquant(s) dans le DOM :`,f),console.info("[Preview] L'injection de template devrait suivre. Pas de reload automatique (User choice)."))}function k(t){const{type:e,html:o}=t,r=document.querySelector('main[data-zflex-page-type="home"]');if(!r){console.error("[Preview] Injection annulÃ©e : Ã‰lÃ©ment <main> introuvable.");return}console.log(`%c [Preview] Injection du partiel pour : ${e} `,"background: #4f46e5; color: white; font-weight: bold; padding: 2px 4px; border-radius: 2px;");const l=document.createElement("div");l.innerHTML=o.trim();const f=Array.from(l.childNodes);let p=null;for(const a of f){if(a.nodeType!==Node.ELEMENT_NODE)continue;const s=a,n=s.tagName.toUpperCase();if(n==="STYLE")document.head.appendChild(s);else if(n==="TEMPLATE"){const i=s.getAttribute("data-zflex-variant"),c=s.getAttribute("data-zflex-template"),d=i||c;if(d){const g=document.querySelector(`template[data-zflex-variant="${d}"], template[data-zflex-template="${d}"]`);g&&g.remove()}document.body.appendChild(s)}else if(n==="SCRIPT"){const i=document.createElement("script");Array.from(s.attributes).forEach(c=>i.setAttribute(c.name,c.value)),i.textContent=s.textContent,document.body.appendChild(i)}else console.log(`[Preview] -> Potential content node found: ${n}`),p=s}if(p)try{const a=p;a.setAttribute("data-zflex-section",e),t.data&&(console.log(`[Preview] Hydratation immÃ©diate pour ${e} avec :`,t.data),v(a,t.data,e),a.querySelectorAll("[data-zflex-repeater]").forEach(i=>{const c=i.getAttribute("data-zflex-repeater");if(!c)return;const d=c.split("."),g=d[d.length-1],u=t.data[g];Array.isArray(u)&&x(i,c,u)}));const s=r.querySelector(`[data-zflex-section="${e}"]`);s?(console.log(`[Preview] Replacing existing section: ${e}`),s.replaceWith(a)):(console.log(`[Preview] Appending new section: ${e}`),r.appendChild(a)),console.log(`[Preview] Section ${e} injectÃ©e avec succÃ¨s (+ styles/templates).`),a.style.animation="pulse-glow 1s ease-in-out",typeof I=="function"&&I(a),S()}catch(a){console.error(`[Preview] Erreur fatale lors de l'injection de ${e}:`,a),S()}}function N(t){if(!t)return;const e=t.computed||{},o=t.palette||{},r={};Object.keys(o).forEach(l=>{const f=b(l)||b(`palette.${l}`)||`--${l}`;f&&(r[f]=o[l])}),Object.keys(e).forEach(l=>{const f=b(l)||`--${l.replace(/[A-Z]/g,p=>"-"+p.toLowerCase())}`;f&&(r[f]=e[l])}),q(r),console.log("[Preview] Applied computed palette vars:",r)}function W(t){if(t==null)return"";let e=String(t).trim();return/^[0-9A-Fa-f]{6}$/.test(e)&&(e="#"+e),e}function P(t){if(!t)return;let{property:e,value:o}=t;const r=b(e)||e,l=W(o);r&&(document.documentElement.style.setProperty(r,l),(r.includes("color")||r.includes("bg")||r.includes("background"))&&(document.body.style.transition="background-color 0.22s ease, color 0.22s ease, border-color 0.22s ease",setTimeout(()=>{document.body.style.transition=""},300)),console.log(`[Preview] Mise Ã  jour style (incoming: ${String(e)}) -> canonical: ${r}: ${l}`))}function T(t,e){if(!t)return;const{id:o,value:r}=t,l=b(o);if(l&&(l.startsWith("--")||o.startsWith("palette.")||o.startsWith("layout.")||o.startsWith("typography."))&&(P({property:o,value:r}),o.includes(".")&&(o.startsWith("palette")||o.startsWith("layout")||o.startsWith("typography"))))return;if(o==="buttons.style"){document.body.setAttribute("data-button-style",String(r||"solid").toLowerCase());return}if(o==="buttons.radius"){document.body.setAttribute("data-button-radius",String(r||"md").toLowerCase());return}if(o==="howItWorks.showIcons"){const a=String(r)==="true",s=document.querySelector('[data-zflex-section="howItWorks"]');if(s){const n=s.querySelectorAll(".step-num:not(template .step-num)"),i=s.querySelectorAll(".step-icon:not(template .step-icon)");console.log(`[Preview] Toggling howItWorks icons: ${a?"ON":"OFF"} (${n.length} numbers, ${i.length} icons)`),n.forEach(c=>c.style.display=a?"none":""),i.forEach(c=>c.style.display=a?"":"none"),a&&(console.log("[Preview] Re-hydrating icons with current data..."),i.forEach(c=>{const d=c.querySelector("i");if(!d)return;const g=d.getAttribute("data-zflex-id");if(g){const u=d.className;console.log(`  Icon ${g}: ${u}`)}}))}return}const f=document.querySelectorAll(`[data-zflex-show="${o}"]`);if(f.length>0){const a=String(r)==="true";f.forEach(s=>{s.style.setProperty("display",a?"":"none","important")}),a&&$(f[0])}let p=Array.from(document.querySelectorAll(`[data-zflex-id="${o}"]`)).filter(a=>!a.closest("template"));if(p.length===0&&o.includes(".")){const a=o.split(".").pop();p=Array.from(document.querySelectorAll(`[data-zflex-bind="${a}"]`)).filter(s=>{if(s.closest("template"))return!1;const n=o.split(".")[0];return!!(s.closest(`[data-zflex-section="${n}"]`)||s.closest(`[data-zflex-variant-container="${n}"]`))})}if(p.length===0){e?A(o,e):console.warn(`[Preview] Aucun Ã©lÃ©ment trouvÃ© pour : ${o}`);return}p.forEach(a=>{const s=a,n=s.tagName.toUpperCase();if(n==="IMG")console.log(`[Preview] Updating IMG src for ${o}:`,r),s.src=r,s.alt||(s.alt="Image");else if(n==="I"||s.classList.contains("fa")||o.toLowerCase().includes("icon")){let d=String(r).trim();if(!d)return;!d.startsWith("fa-")&&!d.includes(" ")&&(d=`fa-${d}`),/fa[srbl]/.test(d)||(d=`fas ${d}`);const g=Array.from(s.classList).filter(u=>!u.startsWith("fa-")&&!/fa[srbl]/.test(u)&&u!=="fa");s.className=`${g.join(" ")} ${d}`}const i=typeof r=="string"&&(r.startsWith("http")||r.startsWith("data:image")||r.startsWith("/"));if(o.toLowerCase().includes("image")||o.includes("bg")||o.includes("cover")||i&&n!=="IMG"&&n!=="I"){console.log(`[Preview] Updating BG for ${o}:`,r);const d=s.style.backgroundImage;if(d&&d.includes("gradient")){const g=d.replace(/url\(['"]?.*?['"]?\)/,`url('${r}')`);s.style.backgroundImage=g}else s.style.backgroundImage=`url('${r}')`}else/<[a-z][\s\S]*>/i.test(String(r))?s.innerHTML=String(r):s.textContent=String(r);n!=="I"&&$(s)})}function $(t){t&&(t.classList.remove("zflex-highlight-pulse"),t.offsetWidth,t.classList.add("zflex-highlight-pulse"),t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}))}function M(){if(document.getElementById("zflex-preview-styles"))return;const t=document.createElement("style");t.id="zflex-preview-styles",t.textContent=`
    .zflex-highlight-pulse {
      position: relative;
      animation: zflexHighlightPulse 1.2s ease-out;
      z-index: 100 !important;
    }
    @keyframes zflexHighlightPulse {
      0% { outline: 0px solid rgba(0, 229, 255, 0); outline-offset: 0px; }
      20% { outline: 4px solid rgba(0, 229, 255, 0.8); outline-offset: 2px; }
      100% { outline: 0px solid rgba(0, 229, 255, 0); outline-offset: 10px; }
    }
  `,document.head.appendChild(t)}function U(t){const{id:e}=t;let o=document.querySelector(`[data-zflex-section="${e.toLowerCase()}"]`)||document.querySelector(`[data-zflex-id="${e}"]`)||document.getElementById(e);o?$(o):console.log(`[Preview] Highlight: Element ${e} not found.`)}function E(t){if(!t?.data)return;const e=t.data;if(e.source==="zflex-admin")switch(console.log("[Preview] Message reÃ§u de l'Ã©diteur:",e),e.action){case"updateElement":T(e.payload,e);break;case"updateStyle":P(e.payload);break;case"updatePalette":N(e.payload);break;case"updateRepeater":j(e.payload,e);break;case"updateVariant":R(e.payload);break;case"updateLayout":L(e.payload);break;case"highlight":U(e.payload);break;case"injectTemplate":k(e.payload);break;default:console.warn("[Preview] Action non reconnue:",e.action)}}window.addEventListener("message",E);function R(t){const{id:e,variant:o,data:r}=t;if(e==="buttons"){console.log(`[Preview] Global Button Style Update: ${o}`),document.body.setAttribute("data-button-style",String(o).toLowerCase());return}const l=document.querySelector(`[data-zflex-variant-container="${e}"]`),f=document.querySelector(`template[data-zflex-variant="${e}.${o}"]`);if(!l||!f){console.warn(`[Preview] Impossible de changer le variant : ${e} -> ${o} (Template/Container missing)`);return}console.log(`[Preview] Swap variant ${e} vers ${o}`);const a=f.content.cloneNode(!0).firstElementChild;a&&(v(a,r,e),a.querySelectorAll("[data-zflex-repeater]").forEach(n=>{const i=n.getAttribute("data-zflex-repeater");if(!i)return;const c=i.split("."),d=c[c.length-1],g=r[d];Array.isArray(g)&&x(n,i,g)}),l.style.opacity="0",setTimeout(()=>{l.innerHTML="",l.appendChild(a),l.style.opacity="1"},150))}function x(t,e,o){const r=document.querySelector(`template[data-zflex-template="${e}"]`);if(!r)return;t.innerHTML="";const l=e.split(".")[0],f=document.querySelector(`[data-zflex-section="${l}"]`);o.forEach((p,a)=>{const s=r.content.cloneNode(!0),n=Array.from(s.children);n.length!==0&&(n.forEach(i=>{B(i,e,a);const c=i.querySelector(".step-num");if(c&&c.textContent==="#"&&(c.textContent=String(a+1)),e.includes("howItWorks.steps")&&f){const d=i.querySelectorAll(".step-num"),g=i.querySelectorAll(".step-icon"),u=f.querySelector(".step-icon:not(template .step-icon)"),m=u&&u.style.display!=="none";d.forEach(h=>h.style.display=m?"none":""),g.forEach(h=>h.style.display=m?"":"none")}v(i,p,`${e}[${a}]`)}),t.appendChild(s))})}function B(t,e,o){if(t.querySelectorAll("[data-zflex-bind]").forEach(f=>{const p=f.getAttribute("data-zflex-bind");f.setAttribute("data-zflex-id",`${e}[${o}].${p}`)}),t.hasAttribute("data-zflex-bind")){const f=t.getAttribute("data-zflex-bind");t.setAttribute("data-zflex-id",`${e}[${o}].${f}`)}t.querySelectorAll("[data-zflex-show]").forEach(f=>{const p=f.getAttribute("data-zflex-show");p&&!p.startsWith(e)&&f.setAttribute("data-zflex-show",`${e}[${o}].${p}`)})}function v(t,e,o=""){const r=Array.from(t.querySelectorAll("[data-zflex-bind]"));t.hasAttribute("data-zflex-bind")&&r.push(t);const l=(n,i,c,d)=>{if(o&&!n.hasAttribute("data-zflex-id")&&n.setAttribute("data-zflex-id",`${o}.${i}`),c==null&&!(i==="icon"||i==="image"))return;const g=n.tagName.toUpperCase();if(i==="index"&&d!==void 0){n.textContent=String(d+1);return}if(n.textContent?.trim()==="#"&&d!==void 0){n.textContent=String(d+1);return}if(g==="IMG")n.src=String(c||"");else if(i==="icon"||n.tagName==="I"||n.classList.contains("fa")){let u=String(c||"").trim();if(console.log(`[Hydrate] Icon field detected: key="${i}", tag="${n.tagName}", class="${n.className}", value="${u}"`),u){let m=n;if(n.tagName!=="I"){const y=n.querySelector("i");y&&(m=y,console.log(`  â†’ Using child <i> element instead of ${n.tagName}`))}!u.startsWith("fa-")&&!u.includes(" ")&&(u=`fa-${u}`),!u.includes("fas")&&!u.includes("fab")&&!u.includes("far")&&!u.includes("fal")&&(u=`fas ${u}`);const h=Array.from(m.classList).filter(y=>!y.startsWith("fa")&&y!=="fas"&&y!=="fab"&&y!=="far"&&y!=="fal");m.className=`${h.join(" ")} ${u}`,console.log(`  â†’ Final icon class: "${m.className}"`)}}else if(i.toLowerCase().includes("image")||i.includes("bg")||i.includes("cover")){if(g!=="IMG"){const u=n.style.backgroundImage;if(u&&u.includes("gradient")){const m=u.replace(/url\(['"]?.*?['"]?\)/,`url('${c||""}')`);n.style.backgroundImage=m}else n.style.backgroundImage=`url('${c||""}')`}}else i==="image_position"||i==="imagePosition"?c==="left"?(n.classList.remove("image-right"),n.classList.add("image-left")):(n.classList.remove("image-left"),n.classList.add("image-right")):i==="style"&&n.classList.contains("reveal-section")?n.className=n.className.replace(/style-\w+/,`style-${c}`):/<[a-z][\s\S]*>/i.test(String(c))?n.innerHTML=String(c):n.textContent=String(c);if(o.includes("features.items")&&(i==="image"||i==="icon")){const u=n.closest(".feature-visual-wrapper");if(u){const m=u.querySelector(".feature-img-bind"),h=u.querySelector(".feature-icon-bind");if(m&&h){const y=m,C=y.src&&!y.src.includes("undefined")&&!y.src.endsWith("/");m.style.display=C?"":"none",h.style.display=C?"none":""}}}},f=o.match(/\[(\d+)\]/),p=f?parseInt(f[1]):void 0;r.forEach(n=>{const i=n,c=i.getAttribute("data-zflex-bind");c&&l(i,c,e[c],p)});const a=Array.from(t.querySelectorAll("[data-zflex-show]"));t.hasAttribute("data-zflex-show")&&a.push(t);const s=n=>{const i=n,c=i.getAttribute("data-zflex-show");if(!c)return;let d=e[c];if(c.includes(".")&&!c.includes("[")){const u=c.split("."),m=u[u.length-1];d=e[m]}const g=String(d)==="true"||d===!0;i.style.setProperty("display",g?"":"none","important")};if(a.forEach(n=>s(n)),o.includes("reveal")&&e.imagePosition){const n=t.querySelector(".reveal-grid");n&&l(n,"imagePosition",e.imagePosition)}}function j(t,e){const{id:o,items:r}=t,l=document.querySelector(`[data-zflex-repeater="${o}"]`);l?(console.log(`[Preview] RÃ©gÃ©nÃ©ration du repeater ${o}`),x(l,o,r),l.style.transition="opacity 0.2s",l.style.opacity="0.5",setTimeout(()=>l.style.opacity="1",200)):e?A(o,e):console.warn(`[Preview] Repeater container not found: ${o}`)}function F(){console.log("[Preview] Activating Interaction Hijacking (Anti-Navigation)"),document.addEventListener("click",t=>{const e=t.target.closest("a, button, input[type='submit']");if(!e)return;if(e.classList.contains("btn-primary")||e.id.includes("add-to-cart")||e.textContent?.toLowerCase().includes("commander")||e.closest("#cart-btn")){t.preventDefault(),t.stopPropagation(),console.log("ðŸš« [Preview] Action commerciale bloquÃ©e:",e);return}if(e.tagName==="A"){const r=e.getAttribute("href");if(r&&r!=="#"&&!r.startsWith("javascript:")){t.preventDefault(),t.stopPropagation(),console.log("ðŸš« [Preview] Navigation bloquÃ©e:",r);return}}console.log("âœ… [Preview] Interaction autorisÃ©e:",e)},!0),document.addEventListener("submit",t=>{t.preventDefault(),t.stopPropagation(),console.log("ðŸš« [Preview] Soumission de formulaire bloquÃ©e.")},!0)}function H(){window.__ZFLEX_PREVIEW_MODE__=!0,console.log("ðŸš« [Preview] Analytics neutralized via Global Flag.")}window.parent!==window&&window.parent.postMessage({source:"zflex-preview",action:"ready",payload:{url:window.location.href}},"*")}export{V as initPreviewMode};
